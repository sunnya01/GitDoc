## 网络编程

1. 什么是网络: 计算机之间的通讯称为网络

2. 网络发展史以及TCP/IP协议的5层结构解析

   局域网之HUB:计算机之间通过一个HUB连接到一起,同一时间只有一台计算机可以发出输出请求,HUB将得到的请求广播发送(物理层)

   局域网之交换机:交换机内部记录了mac与物理网线端口的路由表，内部进行转发,这个时候网线变成了信息传输的物理介质(链路层)

   局域网之网络: 交换机虽然能解决范围内的网络处理但是大范围的计算机网络交互任然存在问题例如需要交换机记录大量的MAC路由信息，交换机之间连接的代价昂贵等问题，因此出现了虚拟ip的概念用来实现局域网络之间的交互(网络层)主要实现的是局域网之间的寻址，以及路由工作能够通过路由器实现找到目标IP的最佳路由路径，并给每个网络中的设备给予一个新的虚拟ip身份

   TCP/UDP: 传输层协议，基于IP协议的一种传输方式的统一协定协议，IP(网络层)提供了一种在网络中定位的基础，而TCP传输层则定义了如何进行一套可靠的传输过程

   Http/Ftp: 应用层，这一层是直接面向用户的

3. 传输过程简介

   举例访问某个网址并登陆账号: 

   第一 用户在网址中输入一个Http地址，可能是个域名，然后该域名会发送到附近的DNS(域名解析服务)解析成IP地址

   第二 用户输入账号密码信息，之后应用层的浏览器会将目标的IP+端口号组成一个socket，并将账号密码信息包装成数据

   第三接下来到了传输层，根据选择的TCP协议，首先会通过网络与目标进行握手协议假设这里已经握手成功

   第四接下来到了网络层，网络层会把上面的数据都进行包装 即 网络层的本机局域网ip 本机默认网关ip 本机运营商网络的局域网ip 本机主代理的公网ip 传输层协议 以及传输层部分其他信息 然后应用层协议例如http协议 然后才是账号密码信息的二进制数据，本机的网络层会判断目标ip是否存在本计算机的网络路由表中如果不存在选择发往默认网关也就是本机直接连接的路由器

   第五链路层 链路层根据网络层广播寻址的默认网关的MAC地址，进行传输将上面封装的包括ip信息的所有数据包安帧推送到物理层也就是网线上发送到目标MAC地址

   第六层物理层，通过链路层选择物料网线端口对拿到的数据进行二进制电信号发送

   然后 数据到达了默认网关，路由器会将数据从物理层接收，然后到链路层将每一帧数据合并以后提供给网络层

   路由器的网络层解析获得ip信息后停止解析结合路由器上的路由表选择如果目标ip在路由表内则直接发送到目标设备同样通过广播获得mac地址然后交由链路层完成物料推送如果不在则将本路由器的ip地址包装回网络层数据包，并继续携带者上一层网关的mac地址向链路层推送继续进行下一跳处理

   直到到达目标IP地址(如果要访问某个设备他必须保证他的某个端口能够映射到公网的某个ip+端口但是他的响应则可以根据他拿到的数据包里面的每一跳ip地址进行返回也就是服务端如果想要被人访问到要求是很严格的但是客户端访问到他以后，响应数据就可以原路返回)

   目标计算机也是从物理层先收到链路层包装的帧数据然后解析到网络层，网络层确认IP正确以后，到达传输层，传输层根据TCP协议将数据完整组装，交给到应用层

4. Java中的TCP访问

   ```java
           System.out.println("这里是客户端请您输入即将发送的文字内容:");
   
           InetAddress inetAddress = InetAddress.getByName("127.0.0.1");
   
           Socket socket = new Socket(inetAddress, 8899);
   
           OutputStream outputStream = socket.getOutputStream();
   
           OutputStreamWriter osw = new OutputStreamWriter(outputStream);
   
           Scanner scanner = new Scanner(System.in);
   
           for (; ; ) {
   
               scanner.hasNext();
   
               String next = scanner.next();
   
               osw.write(next);
   
               osw.flush();
   
               if (next.contains("e")) break;
   
           }
   
           osw.close();
   
           socket.close();
           System.out.println("这里是服务端以下是外部发送过来的内容:");
           InputStreamReader isr = null;
           InputStream inputStream = null;
           Socket accept = null;
           char[] buffer = new char[10];
           int len;
           int index = 0;
           ServerSocket serverSocket = new ServerSocket(8899);
           accept = serverSocket.accept();
           inputStream = accept.getInputStream();
           isr = new InputStreamReader(inputStream);
           for (; ; ) {
               try {
                   Thread.sleep(1000);
               } catch (InterruptedException e) {
                   throw new RuntimeException(e);
               }
               if ((len = isr.read(buffer)) != -1) {
                   String text = new String(buffer, 0, len);
                   System.out.println(text);
                   if (text.contains("e")) break;
               }
           }
           isr.close();
           accept.close();
           serverSocket.close();
   ```

5. Java中的URL访问

```java
package TempTest;

import java.io.*;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLConnection;
import java.util.Scanner;

public class MovieDownload {

    public static void main(String[] args) throws IOException {

        String url = null;
        //输入下载资源地址
        Scanner scanner = new Scanner(System.in);

        msg("请输入需要下载的资源地址(HTTP应用层地址):");

        if (scanner.hasNext())
            url = scanner.next();

        if (!(url.startsWith("http") || url.startsWith("https"))) {
            msg("输入的地址不合理!");
            return;
        } else {
            scanner.close();
            msg("地址获取完毕关闭控制台输入流!");
        }
        //1. 获取URL对象
        URL lr_url = new URL(url);//https://ftp.yz.yamagata-u.ac.jp/pub/eclipse/oomph/epp/2025-12/R/eclipse-inst-jre-win64.exe

        //2. 建立连接
        HttpURLConnection urlConnection = (HttpURLConnection) lr_url.openConnection();

//        urlConnection.setRequestMethod("POST");

//        urlConnection.setRequestProperty("User-Agent", "Mozilla/5.0");
        urlConnection.setRequestMethod("GET");

        urlConnection.addRequestProperty("User-Agent", "Mozilla/4.0");

        urlConnection.connect();

        //3. 得到输入字节流
        InputStream inputStream = urlConnection.getInputStream();

        //4. 使用缓冲处理流包装
        BufferedInputStream bis = new BufferedInputStream(inputStream);

        //5. 启用输出字节流下载到本地
        File file = new File("xtlbb-jd-3.71.7215-3.71.7227.exe");

        FileOutputStream fos = new FileOutputStream(file);

        BufferedOutputStream bos = new BufferedOutputStream(fos);

        byte[] buff = new byte[1024];

        int len;

        //6. 开始下载
        while ((len = bis.read(buff)) != -1) {
            bos.write(buff, 0, len);
        }

        //7. 关闭
        bos.close();

        bis.close();

        urlConnection.disconnect();

    }

    static public void msg(String value) {
        System.out.println(value);
    }

}
```